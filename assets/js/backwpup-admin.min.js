let requestWPApi,loadBackupsListingAndPagination,getUrlParameter,backwpupDisplaySettingsToast;jQuery(document).ready(function($){const $document=$(document);async function postToWP(e){return await fetch(ajaxurl,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded","Cache-Control":"no-cache"},body:new URLSearchParams(e)}).then(e=>e.json())}function enableBackupButton(e=!0){$(".backwpup-button-backup").prop("disabled",!e),$(".backwpup-btn-backup-job").prop("disabled",!e);let a=e?"visible":"hidden";jQuery(".backwpup-btn-backup-job span span.tooltip").css("visibility",a)}function enableDeleteJob(e=!0){console.log("enableDeleteJob",e),e?$(".js-backwpup-delete-job").removeClass("disabled"):$(".js-backwpup-delete-job").addClass("disabled")}requestWPApi=function(e,a,t,n="GET",o=null){const s=$(document.activeElement),i=$("#backwpup-loading-overlay-template").children().first(),c=s.closest(".backwpup-job-card");let r;c.length&&(r=i.clone(),r.find("svg").addClass("animate-spin"),c.find(".backwpup-loading-overlay").remove(),c.append(r)),$.ajax({url:e,beforeSend:function(e){e.setRequestHeader("X-WP-Nonce",backwpupApi.nonce)},method:n,data:a,success:function(e){r?.remove(),s.prop("disabled",!1),s.siblings(".backwpup-loading-overlay").remove(),t(e,a)},error:function(t,i){console.error("API Request Failed:",e,n,a,t.status,t.statusText),console.trace("Error triggered in requestWPApi"),r?.remove(),s.prop("disabled",!1),s.siblings(".backwpup-active-spinner").remove(),o&&o(t,i)}})},getUrlParameter=function(e,a=""){let t=new URLSearchParams(window.location.search);return t.has(e)?t.get(e):a},backwpupDisplaySettingsToast=function(e="info",a="",t=5e3){a&&requestWPApi(backwpupApi.getblock,{block_name:"alerts/info",block_type:"component",block_data:{type:e,font:"small",dismiss_icon:!0,content:a}},function(a){const n=jQuery('<div class="transform translate-y-2 transition-all duration-300"></div>').html(a);$("#bwp-settings-toast").html(""),$("#bwp-settings-toast").append(n),setTimeout(()=>{n.addClass("opacity-100 translate-y-0")},10),-1===t&&"success"===e||setTimeout(()=>{n.removeClass("opacity-100 translate-y-0").addClass("opacity-0 translate-y-2"),setTimeout(()=>{n.remove()},300)},t)},"POST",function(e,a){console.log(a,e)})},$(".js-backwpup-intonly").on("keydown",function(e){return!!["Backspace","Delete","ArrowLeft","ArrowRight"].includes(e.code)||!isNaN(Number(e.key))&&"Space"!==e.code}),window.refresh_storage_destinations=function(e,a,t){$("#destination-"+a).prop("checked",t);const n=[""];$('input[name="storage_destinations[]"]').each(function(){$(this).is(":checked")&&n.push($(this).val())}),requestWPApi(backwpupApi.updatejob,{job_id:e,storage_destinations:n},function(e){requestWPApi(backwpupApi.storagelistcompact,{},function(e){$("#backwpup-storage-list-compact-container").html(e)},"GET",function(e,a){$("#backwpup-storage-list-compact-container").html(e.responseText)})},"POST",function(e,a){$("#backwpup-storage-list-compact-container").html(e.responseJSON.error)});0!==$('input[type="checkbox"][name^="onboarding_storage"]:checked').length?$(".js-backwpup-onboarding-submit-form").prop("disabled",!1):$(".js-backwpup-onboarding-submit-form").prop("disabled",!0)},window.gdrive_refresh_authentification=function(){requestWPApi(backwpupApi.cloud_is_authenticated,{cloud_name:"gdrive"},function(e){$("#gdrive_authenticate_label").html(e)},"GET")},window.onedrive_refresh_authentification=function(){requestWPApi(backwpupApi.cloud_is_authenticated,{cloud_name:"onedrive"},function(e){$("#onedrive_authenticate_label").html(e)},"GET")},window.dropbox_refresh_authentification=function(e){requestWPApi(backwpupApi.cloud_is_authenticated,{job_id:e,cloud_name:"dropbox"},function(e){$("#drobox_authenticate_infos").html(e)},"GET")},window.update_license=function(){const e=$("#license_action").val(),a={license_action:e,license_instance_key:$("#license_instance_key").val(),license_submit:!0};let t="activate";"activate"===e&&(t="deactivate",a.license_api_key=$("#license_api_key").val(),a.license_product_id=$("#license_product_id").val()),requestWPApi(backwpupApi.license_update,a,function(e){requestWPApi(backwpupApi.getblock,{block_name:"alerts/info",block_type:"component",block_data:{type:"info",font:"xs",content:e.message}},function(e){$("#backwpup_message").html(e)},"POST",function(e,a){console.log(e.responseJSON.error)}),backwpup_license_refresh(t)},"POST",function(e,a){requestWPApi(backwpupApi.getblock,{block_name:"alerts/info",block_type:"component",block_data:{type:"alert",font:"xs",content:e.responseJSON.error}},function(e){$("#backwpup_message").html(e)},"POST",function(e,a){console.log(e.responseJSON.error)})})},window.backwpup_license_refresh=function(e){let a="sidebar/license-parts/"+e;requestWPApi(backwpupApi.getblock,{block_name:a,block_type:"children"},function(e){$("#backwpup_license").html(e),$(".js-backwpup-license_update").on("click",update_license)},"POST")},window.load_and_open_storage=function(e){let a=$(e.currentTarget),t=a.data("content"),n=a.data("job-id"),o=a.data("storage"),s=$sidebar.find("#sidebar-"+t);requestWPApi(backwpupApi.getblock,{block_name:"sidebar/"+t,block_type:"children",block_data:{job_id:n,is_in_form:!1}},function(e){switch(s.html(e),$(".js-backwpup-close-sidebar").on("click",closeSidebar),$(".js-backwpup-load-and-open-sidebar").on("click",load_and_open_sidebar),o){case"DROPBOX":initDropboxEvents();break;case"SUGARSYNC":initSugarSyncEvents(),$(".js-backwpup-test-"+o+"-storage").on("click",window["test_"+o+"_storage"]);break;case"GDRIVE":initGdriveEvents(),$(".js-backwpup-test-GDRIVE-storage").on("click",window.test_GDRIVE_storage);break;case"HIDRIVE":initHidriveEvents();break;case"ONEDRIVE":initOnedriveEvents(),$(".js-backwpup-test-ONEDRIVE-storage").on("click",window.test_ONEDRIVE_storage);break;default:$(".js-backwpup-test-"+o+"-storage").on("click",window["test_"+o+"_storage"])}openSidebar(t)},"POST",function(e,a){console.log(a),console.log(e)})};const $modal=$("#backwpup-modal"),$sidebar=$("#backwpup-sidebar");function openSidebar(e){$sidebar.find("article").hide(),$sidebar.find("#sidebar-"+e).show(),$("body").addClass("overflow-hidden"),$sidebar.removeClass("translate-x-[450px]")}function closeSidebar(){$("body").removeClass("overflow-hidden"),$sidebar.addClass("translate-x-[450px]")}window.load_and_open_sidebar=function(e){let a=$(e.currentTarget),t=a.data("content"),n=a.data("job-id");$sidebar.find("article").hide();let o=$sidebar.find("#sidebar-"+t),s={job_id:n,job_type:a.data("job-type")},i={files:$(".js-backwpup-onboarding-files-frequency"),database:$(".js-backwpup-onboarding-database-frequency")};if("frequency"===t&&i.files.is(":visible")&&i.database.is(":visible")){let e={job_2:i.files.val(),job_3:i.database.val()};s.basic_frequency=e[`job_${n}`]}requestWPApi(backwpupApi.getblock,{block_name:a.data("block-name"),block_type:a.data("block-type"),block_data:s},function(e){o.html(e),openSidebar(t),$document.trigger("disableLegacyFrequency",{panel:t}),$(".js-backwpup-close-sidebar").on("click",closeSidebar),$(".js-backwpup-toggle-storage").on("click",load_and_open_storage)},"POST",function(e,a){console.log(a),console.log(e)})},$document.on("click",".js-backwpup-load-and-open-sidebar",load_and_open_sidebar);const legacy_start_days=["first-monday","first-sunday"];let save_settings_button,start_time,day_of_month;$document.on("disableLegacyFrequency",function(e,a){save_settings_button=$("#save-job-settings"),start_time=save_settings_button.closest("article").find("input[name='start_time']"),day_of_month=$("#backwpup_day_of_month"),"frequency"===a.panel&&legacy_start_days.includes(day_of_month.val())&&(start_time.prop("disabled",!0),save_settings_button.prop("disabled",!0))});const frequency_field_targets=["#backwpup_day_of_month","#backwpup_frequency"];function openModal(e,a={}){$modal.find("article").hide();let t=$modal.find("#sidebar-"+e);t.show(),a.url&&t.find(".js-backwpup-open-url").attr("data-href",a.url),$("body").addClass("overflow-hidden"),$modal.removeClass("hidden").addClass("flex")}function closeModal(){$("body").removeClass("overflow-hidden"),$modal.addClass("hidden").removeClass("flex")}function initSugarSyncEvents(){$(".js-backwpup-authenticate-sugar-sync").on("click",function(){const e=new URLSearchParams(window.location.search).get("page");let a=$(this).data("job-id");"backwpuponboarding"===e&&(a=null);let t={job_id:a,cloud_name:"sugarsync",sugaremail:$("#sugaremail").val(),sugarpass:$("#sugarpass").val()};requestWPApi(backwpupApi.authenticate_cloud,t,function(e){$("#sugarsynclogin").html(e),$("#sugarsync_authenticate_infos").html(""),refreshSugarSyncRootFolders(a),initSugarSyncEvents()},"POST",function(e,t){$("#sugarsync_authenticate_infos").html(e.responseText),refreshSugarSyncRootFolders(a)})}),$(".js-backwpup-delete-sugar-sync-auth").on("click",function(){const e=new URLSearchParams(window.location.search).get("page");let a=$(this).data("job-id");"backwpuponboarding"===e&&(a=null);const t={job_id:a,cloud_name:"sugarsync"};requestWPApi(backwpupApi.delete_auth_cloud,t,function(e){refresh_storage_destinations(a,"SUGARSYNC",!1),$("#sugarsynclogin").html(e),refreshSugarSyncRootFolders(a),initSugarSyncEvents()},"POST",function(e,a){alert("Error in cloud configuration")})})}function initGdriveEvents(){$(".js-backwpup-gdrive-connect-api").on("click",function(){const e=$(this).closest("details");let a={backwpup_cfg_googleclientsecret:{value:$("#backwpup_cfg_googleclientsecret").val(),secure:!0},backwpup_cfg_googleclientid:{value:$("#backwpup_cfg_googleclientid").val(),secure:!1}};requestWPApi(backwpupApi.save_site_option,a,function(a){$("#gdrive_authenticate_infos").html(a.message),e.removeAttr("open")},"POST",function(e,a){$("#gdrive_authenticate_infos").html("Error")})}),$(".js-backwpup-gdrive-reauthenticate").on("click",function(){openModal("dialog"),$(".js-backwpup-refresh-authentification").data("trigger","gdrive_refresh_authentification"),window.open($(this).data("url"),"_blank")})}function initDropboxEvents(){$(".js-backwpup-modal-and-focus").on("click",modal_and_focus),$(".js-backwpup-test-DROPBOX-storage").on("click",function(){let e=$(this).data("job-id");"backwpuponboarding"===new URLSearchParams(window.location.search).get("page")&&(e=null);const a={job_id:e,cloud_name:"dropbox",dropboxmaxbackups:$("#dropboxmaxbackups").val(),dropboxdir:$("#dropboxdir").val()};let t=$("#dropbbox_code").val();t&&(a.dropbbox_code=t);let n=$("#sandbox_code").val();n&&!t&&(a.sandbox_code=n),requestWPApi(backwpupApi.cloudsaveandtest,a,function(a){refresh_storage_destinations(e,"DROPBOX",a.connected),dropbox_refresh_authentification(e),closeSidebar()},"POST",function(a,t){refresh_storage_destinations(e,"DROPBOX",!1),alert(a.responseJSON.error)})}),$(".js-backwpup-delete-dropbox-auth").on("click",function(){let e=$(this).data("job-id");"backwpuponboarding"===new URLSearchParams(window.location.search).get("page")&&(e=null);const a={job_id:e,cloud_name:"dropbox",delete_auth:!0,dropboxmaxbackups:$("#dropboxmaxbackups").val(),dropboxdir:$("#dropboxdir").val()};requestWPApi(backwpupApi.cloudsaveandtest,a,function(a){refresh_storage_destinations(e,"DROPBOX",a.connected),dropbox_refresh_authentification(e),closeSidebar()},"POST",function(e,a){alert(e.responseJSON.error)})})}function initModalEvent(){function e(){const e=$(this).data("content");let a={};$(this).data("url")&&(a.url=$(this).data("url")),openModal(e,a)}$(document).on("click",".js-backwpup-open-modal",e),$(".js-backwpup-open-modal").on("click",e)}frequency_field_targets.forEach(e=>{$("#backwpup-sidebar").on("change",e,function(){if(legacy_start_days.includes(day_of_month.val())&&"monthly"===$("#backwpup_frequency").val())return start_time.prop("disabled",!0),void save_settings_button.prop("disabled",!0);start_time.prop("disabled",!1),save_settings_button.prop("disabled",!1)})}),window.load_and_open_modal=function(e){let a=$(e.currentTarget),t=a.data("content"),n=a.data("job-id"),o=$modal.find("#sidebar-"+t);requestWPApi(backwpupApi.getblock,{block_name:a.data("block-name"),block_type:a.data("block-type"),block_data:{job_id:n}},function(e){o.html(e),openModal(t),$(".js-backwpup-close-modal").on("click",closeModal)},"POST",function(e,a){console.log(a),console.log(e)})},$document.on("click",".js-backwpup-load-and-open-modal",load_and_open_modal),window.load_exclusions_modal=function(e,a){let t=$modal.find("#sidebar-"+a),n="modal/"+a;requestWPApi(backwpupApi.getblock,{block_name:n,block_type:"children",block_data:{job_id:e}},function(e){t.html(e),$(".js-backwpup-close-modal").on("click",closeModal)},"POST",function(e,a){console.log(a),console.log(e)})},$document.on("click",".js-data-settings-files, .onboarding-advanced-files-settings ",function(){let e=$(this).data("job-id");["exclude-files-core","exclude-files-plugins","exclude-files-root","exclude-files-themes","exclude-files-uploads","exclude-files-wp-content"].forEach(function(a){load_exclusions_modal(e,a)})}),$document.on("click",".js-backwpup-open-sidebar",function(){openSidebar($(this).data("content"))}),$(".js-backwpup-close-sidebar").on("click",closeSidebar),$(".js-backwpup-open-url").on("click",function(){$(this).data("href")&&(window.location=$(this).data("href"))}),window.refreshSugarSyncRootFolders=function(e){const a=$("#backwpup-loading-overlay-template").children().first(),t=$("#sidebar-storage-SUGARSYNC");let n;t.length&&(n=a.clone(),n.find("svg").addClass("animate-spin"),t.find(".backwpup-loading-overlay").remove(),t.append(n)),requestWPApi(backwpupApi.getblock,{block_name:"sidebar/sugar-sync-parts/root-folder",block_type:"children",block_data:{job_id:e}},function(e){$("#sugarsyncroot").html(e),n?.remove()},"POST",function(e,a){$("#sugarsyncroot").html(e.responseText),n?.remove()})},$document.on("click",".js-backwpup-close-modal",closeModal),$document.on("keyup",".js-backwpup-filter-tables",function(){const e=$(this).val().toLowerCase();$(".js-backwpup-tables-list label").each(function(){""===e||$(this).find("input").attr("value").toLowerCase().includes(e)?$(this).show():$(this).hide()})}),$(".js-backwpup-filter-tables").next(".js-backwpup-clear-search").on("click",function(){$(".js-backwpup-tables-list label").show()});const $backupsTable=$("#backwpup-backup-history");let isCheckboxListenerInitialized=!1;function initMenuEvent(){$(".js-backwpup-menu").on("click",function(e){e.stopPropagation();const a=$(this).find(".js-backwpup-menu-content");$(".js-backwpup-menu-content").not(a).addClass("hidden"),a.hasClass("hidden")?a.removeClass("hidden"):a.addClass("hidden")}),$("#bulk-actions-apply").prop("disabled",!0),$(".js-backwpup-select-backup").on("click",function(){const e=$(".js-backwpup-select-backup:checked").length>0;$("#bulk-actions-apply").prop("disabled",!e)})}function initPaginationEvent(){$(".js-backwpup-table-pagination button").on("click",function(){let e=$(this).data("page");loadBackupsListingAndPagination(e);let a=new URL(window.location.href);a.searchParams.set("page_num",e),history.pushState({},"",a)})}$(".js-backwpup-select-all").on("change",function(){const e=$(this).prop("checked");$("#bulk-actions-apply").prop("disabled",!e),$backupsTable.find("input[type=checkbox]").prop("checked",e),isCheckboxListenerInitialized||($backupsTable.on("change","input[type=checkbox]",function(){const e=$backupsTable.find("input[type=checkbox]").length===$backupsTable.find("input[type=checkbox]:checked").length;$(".js-backwpup-select-all").prop("checked",e)}),isCheckboxListenerInitialized=!0)}),$(document).on("click",function(){$(".js-backwpup-menu-content").addClass("hidden")}),loadBackupsListingAndPagination=function(e){requestWPApi(backwpupApi.backupslistings,{page:e,length:backwpupApi.backupslistingslength},refreshBackupTable,"POST")},$(".js-backwpup-toggle-tables").on("click",function(){postToWP({action:"backwpup_toggle_database",tables:$(this).is(":checked")}).then(e=>{})}),$(".js-backwpup-clear-search").on("click",function(){$(this).prev().val("")}),$document.on("click",".js-backwpup-add-input-button",function(){const e=$(this).prev().val().trim();if(""===e)return;$(this).prev().val("");let a=$(".js-backwpup-add-input-values").val().split(",");if(!a.includes(e)){a.push(e),a=[...new Set(a)],$(".js-backwpup-add-input-values").val(a.join(","));if(!$(".js-backwpup-add-input-tags button span").map(function(){return $(this).text()}).get().includes(e)){const a=$(this).parents(".js-backwpup-add-input").find(".js-backwpup-add-input-tag-template button").clone();a.find("span").text(e),a.appendTo(".js-backwpup-add-input-tags")}}}),$document.on("click",".js-backwpup-remove-tag",function(){$(this).remove();let e=$(".js-backwpup-add-input-values").val().split(",");e=e.filter(e=>e!==$(this).data("tag")),$(".js-backwpup-add-input-values").val(e.join(","))}),$document.on("click",".js-backwpup-toggle-include button",function(){const e=$(this).parents(".js-backwpup-toggle-include"),a=e.find("input[type=checkbox]");a.prop("checked",!a.prop("checked")),a.prop("checked")?(e.find(".js-backwpup-toggle-include-add").addClass("hidden"),e.find(".js-backwpup-toggle-include-remove").removeClass("hidden")):(e.find(".js-backwpup-toggle-include-add").removeClass("hidden"),e.find(".js-backwpup-toggle-include-remove").addClass("hidden"))}),$(".js-backwpup-start-backup-now").on("click",function(){enableBackupButton(!1),requestWPApi(backwpupApi.startbackup,{},function(e){200===e.status&&window.location.reload()},"POST",function(e,a){console.log(e),console.log(a),enableBackupButton(!0)})}),$document.on("change",".js-backwpup-toggle-exclude",function(){const e=$(this).prop("checked");$(this).closest("div").find("button").prop("disabled",!e)}),$("#backwup-next-scheduled-backups").on("change",".js-backwpup-toggle-job",function(){const e=$(this).prop("checked");let a=$(this).data("job-id"),t="Disable";e||(t="Enable");const n=$(`#backwpup-${a}-options div`).find("[data-tooltip-position]:eq(2)"),o=n.find("span").prop("outerHTML");$(`#backwpup-${a}-options`).find("button:not(.always-enabled)").prop("disabled",!e),requestWPApi(backwpupApi.updatejob,{job_id:a,activ:e},function(e){$(`#backwpup-${a}-options div span.label-scheduled`).html(e.message),n.html(t+" "+o)},"POST")}),$("#backwup-next-scheduled-backups").on("click",".js-backwpup-delete-job",function(){let e=$(this).data("job-id");requestWPApi(backwpupApi.delete_job,{job_id:e},function(a){a.success&&($(`#backwpup-${e}-options`).remove(),0===$(".backwpup-job-card").length&&$("#backwpup-backup-now").prop("disabled",!0),loadBackupsListingAndPagination(getUrlParameter("page_num",1)))},"DELETE",function(e){backwpupDisplaySettingsToast("danger",e.responseJSON.message)})}),$("#backwup-next-scheduled-backups").on("change",".backwpup-dynamic-backup-type",function(){0!==$("#js-backwpup-add-new-backup-form").find('input[name="type"]:checked').length?$(this).is(":checked")?($(this).closest("label").addClass("bg-secondary-lighter border-secondary-base"),$(this).closest("label").find("div").addClass("border-secondary-base")):($(this).closest("label").removeClass("bg-secondary-lighter border-secondary-base"),$(this).closest("label").find("div").removeClass("border-secondary-base")):$(this).prop("checked",!0)});const $target_dynamic_card=".backwpup-dynamic-backup-card",toggleDynamicCardDisplay=(e,a="hidden")=>{const t=".backwpup-add-new-backup-card";if("visible"===a)$(e).is(":visible")||($(e).addClass("flex").removeClass("hidden"),$(t).addClass("hidden").removeClass("flex"));else $(e).is(":visible")&&($(e).addClass("hidden").removeClass("flex"),$(t).addClass("flex").removeClass("hidden"),$(".backwpup-dynamic-input label").removeClass("bg-secondary-lighter border-secondary-base").find("> div").removeClass("border-secondary-base").end().first().addClass("bg-secondary-lighter border-secondary-base").find("input").prop("checked",!0).end().find("> div").addClass("border-secondary-base"))};function initHidriveEvents(){$(".js-backwpup-modal-and-focus").on("click",modal_and_focus),$(".js-backwpup-delete-hidrive-auth").on("click",function(){let e=$(this).data("job_id");"backwpuponboarding"===new URLSearchParams(window.location.search).get("page")&&(e=null);const a={job_id:e,cloud_name:"hidrive",hidrive_delete_authorization:!0,hidrive_max_backups:$("#hidrive_max_backups").val(),hidrive_destination_folder:$("#hidrive_destination_folder").val()};requestWPApi(backwpupApi.cloudsaveandtest,a,function(a){refresh_storage_destinations(e,"HIDRIVE",!1),closeSidebar()},"POST",function(a,t){refresh_storage_destinations(e,"HIDRIVE",!1),alert("Error in cloud configuration")})}),$(".js-backwpup-test-HIDRIVE-storage").on("click",function(){let e=$(this).data("job_id");"backwpuponboarding"===new URLSearchParams(window.location.search).get("page")&&(e=null);const a={job_id:e,cloud_name:"hidrive",hidrive_max_backups:$("#hidrive_max_backups").val(),hidrive_destination_folder:$("#hidrive_destination_folder").val()};let t=$("#hidrive_authorization_code").val();t&&(a.hidrive_authorization_code=t),requestWPApi(backwpupApi.cloudsaveandtest,a,function(a){refresh_storage_destinations(e,"HIDRIVE",a.connected),closeSidebar()},"POST",function(a,t){refresh_storage_destinations(e,"HIDRIVE",!1),alert("Error in cloud configuration")})})}$("#backwup-next-scheduled-backups").on("click","#js_backwpup_close_dynamic_backup_card",function(){toggleDynamicCardDisplay($target_dynamic_card)}),$("#backwup-next-scheduled-backups").on("click","#js-backwpup-add-new-backup",function(e){e.preventDefault(),$(this).prop("disabled",!0);let a=$(this),t=$("#js-backwpup-add-new-backup-form").find('input[name="type"]:checked').val();2===$("#js-backwpup-add-new-backup-form").find('input[name="type"]:checked').length&&(t="mixed"),requestWPApi(backwpupApi.addjob,{type:t},function(e){1==e.success&&($("#backwpup-backup-now").prop("disabled",!1),loadBackupsListingAndPagination(getUrlParameter("page_num",1)),backwpupDisplaySettingsToast("success",e.message),requestWPApi(backwpupApi.getjobslist,{},function(e){$("#backwup-next-scheduled-backups").html(e);const a=$("#backwpup_dynamic_response_content").html();$("#backwup-next-scheduled-backups").append(a),toggleDynamicCardDisplay($target_dynamic_card)},"GET"))},"POST",function(e,t){backwpupDisplaySettingsToast("error",e.responseText),a.prop("disabled",!1)})}),window.test_S3_storage=function(e){let a=$(e.currentTarget).data("job-id");if("backwpuponboarding"===new URLSearchParams(window.location.search).get("page")&&(a=null),""!=$("#s3bucketerror").html())return refresh_storage_destinations(a,"S3",!1),void alert("Error in Bucket Configurations");const t={job_id:a,cloud_name:"s3",s3region:$("#s3region").val(),s3base_url:$("#s3base_url").val(),s3base_region:$("#s3base_region").val(),s3base_version:$("#s3base_version").val(),s3base_signature:$("#s3base_signature").val(),s3accesskey:$("#s3accesskey").val(),s3secretkey:$("#s3secretkey").val(),s3bucket:$("#s3bucket").val(),s3newbucket:$("#s3newbucket").val(),s3dir:$("#s3dir").val(),s3maxbackups:$("#s3maxbackups").val(),s3storageclass:"STANDARD"===$("#s3storageclass").val()?"":$("#s3storageclass").val()};$("#s3base_multipart").prop("checked")&&(t.s3base_multipart=$("#s3base_multipart").val()),$("#s3base_pathstylebucket").prop("checked")&&(t.s3base_pathstylebucket=$("#s3base_pathstylebucket").val()),$("#s3ssencrypt").prop("checked")&&(t.s3ssencrypt=$("#s3ssencrypt").val()),requestWPApi(backwpupApi.cloudsaveandtest,t,function(e){refresh_storage_destinations(a,"S3",e.connected),closeSidebar()},"POST",function(e,t){refresh_storage_destinations(a,"S3",!1),alert("Error in cloud configuration")})},$(".js-backwpup-test-S3-storage").on("click",window.test_S3_storage),window.test_GLACIER_storage=function(e){let a=$(e.currentTarget).data("job-id");if("backwpuponboarding"===new URLSearchParams(window.location.search).get("page")&&(a=null),""!=$("#glacierbucketerror").html())return refresh_storage_destinations(a,"GLACIER",!1),void alert("Error in Bucket Configurations");const t={job_id:a,cloud_name:"glacier",glacieraccesskey:$("#glacieraccesskey").val(),glaciersecretkey:$("#glaciersecretkey").val(),glacierregion:$("#glacierregion").val(),glaciervault:$("#glaciervault").val(),glaciermaxbackups:$("#glaciermaxbackups").val(),newvault:$("#newvault").val()};requestWPApi(backwpupApi.cloudsaveandtest,t,function(e){refresh_storage_destinations(a,"GLACIER",e.connected),closeSidebar()},"POST",function(e,t){refresh_storage_destinations(a,"GLACIER",!1),alert("Error in cloud configuration")})},$(".js-backwpup-test-GLACIER-storage").on("click",window.test_GLACIER_storage),window.test_FOLDER_storage=function(e){let a=$(e.currentTarget).data("job-id");"backwpuponboarding"===new URLSearchParams(window.location.search).get("page")&&(a=null);const t={job_id:a,cloud_name:"folder",backupdir:$("#backupdir").val(),maxbackups:$("#maxbackups").val()};requestWPApi(backwpupApi.cloudsaveandtest,t,function(e){refresh_storage_destinations(a,"FOLDER",e.connected),closeSidebar()},"POST",function(e,t){refresh_storage_destinations(a,"FOLDER",!1),alert("Error in cloud configuration")})},$(".js-backwpup-test-FOLDER-storage").on("click",window.test_FOLDER_storage),window.test_FTP_storage=function(e){let a=$(e.currentTarget).data("job-id");"backwpuponboarding"===new URLSearchParams(window.location.search).get("page")&&(a=null);const t={job_id:a,cloud_name:"ftp",ftphost:$("#ftphost").val(),ftphostport:$("#ftphostport").val(),ftpuser:$("#ftpuser").val(),ftppass:$("#ftppass").val(),ftptimeout:$("#ftptimeout").val(),ftpdir:$("#ftpdir").val(),ftpmaxbackups:$("#ftpmaxbackups").val(),ftpssl:$("#ftpssl").prop("checked")?1:0,ftppasv:$("#ftppasv").prop("checked")?1:0};requestWPApi(backwpupApi.cloudsaveandtest,t,function(e){refresh_storage_destinations(a,"FTP",e.connected),closeSidebar()},"POST",function(e,t){refresh_storage_destinations(a,"FTP",!1),alert("Error in cloud configuration")})},$(".js-backwpup-test-FTP-storage").on("click",window.test_FTP_storage),window.test_GDRIVE_storage=function(e){let a=$(e.currentTarget).data("job-id");"backwpuponboarding"===new URLSearchParams(window.location.search).get("page")&&(a=null);const t={job_id:a,cloud_name:"gdrive",gdriveusetrash:$("#gdriveusetrash").prop("checked"),gdrivemaxbackups:$("#gdrivemaxbackups").val(),gdrivedir:$("#gdrivedir").val()};requestWPApi(backwpupApi.cloudsaveandtest,t,function(e){refresh_storage_destinations(a,"GDRIVE",e.connected),backwpupDisplaySettingsToast("success",e.message),closeSidebar()},"POST",function(e,t){refresh_storage_destinations(a,"GDRIVE",!1);const n=e.responseJSON&&e.responseJSON.error?e.responseJSON.error:e.responseText||"Unknown error occurred";backwpupDisplaySettingsToast("danger",n,-1)})},$(".js-backwpup-test-GDRIVE-storage").on("click",window.test_GDRIVE_storage),window.test_ONEDRIVE_storage=function(e){let a=$(e.currentTarget).data("job-id");"backwpuponboarding"===new URLSearchParams(window.location.search).get("page")&&(a=null);const t={job_id:a,cloud_name:"onedrive",onedrivedir:$("#onedrivedir").val(),onedrivemaxbackups:$("#onedrivemaxbackups").val()};requestWPApi(backwpupApi.cloudsaveandtest,t,function(e){refresh_storage_destinations(a,"ONEDRIVE",e.connected),closeSidebar()},"POST",function(e,t){refresh_storage_destinations(a,"ONEDRIVE",!1),alert("Error in cloud configuration")})},$(".js-backwpup-test-ONEDRIVE-storage").on("click",window.test_ONEDRIVE_storage),window.test_SUGARSYNC_storage=function(e){let a=$(e.currentTarget).data("job-id");"backwpuponboarding"===new URLSearchParams(window.location.search).get("page")&&(a=null);const t={job_id:a,cloud_name:"sugarsync",sugardir:$("#sugardir").val(),sugarmaxbackups:$("#sugarmaxbackups").val(),sugarroot:$("#sugarroot").val()};requestWPApi(backwpupApi.cloudsaveandtest,t,function(e){refresh_storage_destinations(a,"SUGARSYNC",e.connected),closeSidebar()},"POST",function(e,t){refresh_storage_destinations(a,"SUGARSYNC",!1),alert("Error in cloud configuration")})},$(".js-backwpup-test-SUGARSYNC-storage").on("click",window.test_SUGARSYNC_storage),window.test_RSC_storage=function(e){let a=$(e.currentTarget).data("job-id");"backwpuponboarding"===new URLSearchParams(window.location.search).get("page")&&(a=null);const t={job_id:a,cloud_name:"rsc",newrsccontainer:$("#newrsccontainer").val(),rscdir:$("#rscdir").val(),rscmaxbackups:$("#rscmaxbackups").val(),rsccontainer:$("#rsccontainer").val(),rscusername:$("#rscusername").val(),rscapikey:$("#rscapikey").val(),rscregion:$("#rscregion").val()};requestWPApi(backwpupApi.cloudsaveandtest,t,function(e){refresh_storage_destinations(a,"RSC",e.connected),closeSidebar()},"POST",function(e,t){refresh_storage_destinations(a,"RSC",!1),alert("Error in cloud configuration")})},$(".js-backwpup-test-RSC-storage").on("click",window.test_RSC_storage),window.test_MSAZURE_storage=function(e){let a=$(e.currentTarget).data("job-id");"backwpuponboarding"===new URLSearchParams(window.location.search).get("page")&&(a=null);const t={job_id:a,cloud_name:"msazure",msazureaccname:$("#msazureaccname").val(),msazurekey:$("#msazurekey").val(),msazurecontainer:$("#msazurecontainer").val(),newmsazurecontainer:$("#newmsazurecontainer").val(),msazuredir:$("#msazuredir").val(),msazuremaxbackups:$("#msazuremaxbackups").val()};requestWPApi(backwpupApi.cloudsaveandtest,t,function(e){refresh_storage_destinations(a,"MSAZURE",e.connected),closeSidebar()},"POST",function(e,t){refresh_storage_destinations(a,"MSAZURE",!1),alert("Error in cloud configuration")})},$(".js-backwpup-test-MSAZURE-storage").on("click",window.test_MSAZURE_storage);const $onboardingSteps=$("#backwpup-onboarding-steps"),$onboardingPanes=$("#backwpup-onboarding-panes"),lineStyles="before:bg-secondary-base",circleActiveStyles="bg-secondary-base after:absolute after:z-10 after:inset after:w-12 after:h-12 after:border-secondary-base after:border after:rounded-full after:animate-pulse",circleReachedStyles="bg-secondary-base";function initOnedriveEvents(){$(".js-backwpup-onedrive-reauthenticate").on("click",function(){openModal("dialog"),$(".js-backwpup-refresh-authentification").data("trigger","onedrive_refresh_authentification"),window.open($(this).data("url"),"_blank")}),$(".js-backwpup-one-drive-connect-api").on("click",function(){const e=$(this).closest("details");let a={backwpup_cfg_onedriveclientsecret:{value:$("#backwpup_cfg_onedriveclientsecret").val(),secure:!0},backwpup_cfg_onedriveclientid:{value:$("#backwpup_cfg_onedriveclientid").val(),secure:!1}};requestWPApi(backwpupApi.save_site_option,a,function(a){$("#onedrive_authenticate_infos").html(a.message),e.removeAttr("open")},"POST",function(e,a){$("#onedrive_authenticate_infos").html("Error")})})}function init_network_authentication(){const e=$(".js-backwpup-network-authentication-method").val();$("#network-"+e+"-authentication").show()}function verifyOnboardingStep1(){const e=!$(".js-backwpup-onboarding-toggle-files").prop("checked"),a=!$(".js-backwpup-onboarding-toggle-database").prop("checked");e&&a?$(".js-backwpup-onboarding-step-2").prop("disabled",!0):$(".js-backwpup-onboarding-step-2").prop("disabled",!1)}function refreshBackupTable(e,a){if(e.success&&e.data){var t=e.data,n=jQuery.parseHTML(t);jQuery("#backwpup-backup-history tbody").html(n),window.BWU.downloader.init(),initMenuEvent(),initModalEvent();let o=Math.ceil(jQuery('input[name="nb_backups"]').val()/a.length);requestWPApi(backwpupApi.backupspagination,{page:a.page,max_pages:o},refreshPagination,"POST")}}function refreshPagination(e){if(e.success&&e.data){var a=e.data,t=jQuery.parseHTML(a);jQuery("#backwpup-pagination").html(t),initPaginationEvent()}}function isGenerateJsIncluded(){const e=document.querySelectorAll("script");for(let a of e)if(a.src.includes("backwpup-generate.js")||a.src.includes("backwpup-generate.min.js"))return!0;return!1}function startBackupProcess(e={}){$document.trigger("start-backupjob"),requestWPApi(backwpupApi.startbackup,e,function(e){200===e.status?setTimeout(function(){window.location.reload()},500):301===e.status&&(window.location=e.url)},"POST",function(e,a){$document.trigger("backup-ended")})}if($(".js-backwpup-onboarding-step-1").on("click",function(){$onboardingPanes.find("article").removeClass("flex").addClass("hidden"),$onboardingPanes.find("article[data-step=1]").removeClass("hidden").addClass("flex"),$onboardingSteps.find("article[data-step=2]").removeClass(lineStyles).find("div:first-child").removeClass(circleActiveStyles),closeSidebar()}),$(".js-backwpup-onboarding-step-2").on("click",function(){$onboardingPanes.find("article").removeClass("flex").addClass("hidden"),$onboardingPanes.find("article[data-step=2]").removeClass("hidden").addClass("flex"),$onboardingSteps.find("article[data-step=2]").addClass(lineStyles).find("div:first-child").addClass(circleActiveStyles),$onboardingSteps.find("article[data-step=1] div:first-child").removeClass(circleActiveStyles).addClass(circleReachedStyles),$onboardingSteps.find("article[data-step=3]").removeClass(lineStyles).find("div:first-child").removeClass(circleActiveStyles),closeSidebar()}),$(".js-backwpup-onboarding-step-3").on("click",function(){$onboardingPanes.find("article").removeClass("flex").addClass("hidden"),$onboardingPanes.find("article[data-step=3]").removeClass("hidden").addClass("flex"),$onboardingSteps.find("article[data-step=3]").addClass(lineStyles).find("div:first-child").addClass(circleActiveStyles),$onboardingSteps.find("article[data-step=2] div:first-child").removeClass(circleActiveStyles).addClass(circleReachedStyles),closeSidebar()}),$(".js-backwpup-onboarding-submit-form").on("click",function(){0!==$('input[type="checkbox"][name^="onboarding_storage"]:checked').length&&$("#backwpup-onboarding-form").submit()}),$document.on("click",".js-backwpup-toggle-storage",function(){openSidebar($(this).data("content"))}),$(".js-backwpup-refresh-authentification").on("click",function(){let trigger=$(this).data("trigger");"function"==typeof window[trigger]?window[trigger]():eval(trigger),closeModal()}),window.modal_and_focus=function(e){let a=$(e.currentTarget);openModal("dialog");const t=a.data("id-focus-after");$(".js-backwpup-refresh-authentification").data("trigger",'$("#'+t+'").focus()'),window.open(a.data("url"),"_blank")},$(".js-backwpup-modal-and-focus").on("click",modal_and_focus),$(".js-backwpup-test-storage").on("click",function(){const e={action:"backwpup_test_storage",storage:$(this).data("storage")};postToWP(e).then(a=>{$(`input[name=storage_${e.storage}]`).prop("checked",!0);$(this).closest("#backwpup-sidebar").length>0||closeSidebar()}),$(`input[name=storage_${e.storage}]`).prop("checked",!0);const a=$(this).closest("#backwpup-sidebar").length>0;"backwpuponboarding"===new URLSearchParams(window.location.search).get("page")?closeSidebar():a?openSidebar("storages"):closeSidebar()}),init_network_authentication(),$(".js-backwpup-network-authentication-method").on("change",function(){$("#network-authentications").children("div").hide(),init_network_authentication()}),$(".js-backwpup-sidebar-submit-form").on("click",function(){$(this).siblings("div").children().submit()}),$(".js-backwpup-onboarding-toggle-files").on("change",function(){const e=$(this).prop("checked");$(".onboarding-advanced-files-settings").prop("disabled",!e),$(".onboarding-files-frequency").prop("disabled",!e),$(".onboarding-files-frequency-settings").prop("disabled",!e),verifyOnboardingStep1()}),$(".js-backwpup-onboarding-toggle-database").on("change",function(){const e=$(this).prop("checked");$(".onboarding-advanced-database-setings").prop("disabled",!e),$(".onboarding-database-frequency").prop("disabled",!e),$(".onboarding-database-frequency-settings").prop("disabled",!e),verifyOnboardingStep1()}),$(".js-backwpup-onboarding-files-frequency").on("change",function(){if($("#sidebar-frequency-files")){let e=$("#sidebar-frequency-files").find("select[name='frequency']");e.val(this.value),e.trigger("change")}}),$(".js-backwpup-onboarding-database-frequency").on("change",function(){if($("#sidebar-frequency-tables")){let e=$("#sidebar-frequency-tables").find("select[name='frequency']");e.val(this.value),e.trigger("change")}}),jQuery("#backwpup-backup-history tbody").length>0&&loadBackupsListingAndPagination(getUrlParameter("page_num",1)),initModalEvent(),initSugarSyncEvents(),initDropboxEvents(),initOnedriveEvents(),initGdriveEvents(),initHidriveEvents(),$(document).on("change","#backwpup-job-title",function(){if(!$(this).val().trim())return $("#js-backwpup-edit-title-warning").removeClass("hidden"),void $("#js-backwpup-save-title").prop("disabled",!0);$("#js-backwpup-edit-title-warning").hasClass("hidden")||($("#js-backwpup-edit-title-warning").addClass("hidden"),$("#js-backwpup-save-title").prop("disabled",!1))}),$(document).on("click","#js-backwpup-save-title",function(e){e.preventDefault();const a=$("#backwpup-job-id").val(),t={title:$("#backwpup-job-title").val(),job_id:a};requestWPApi(backwpupApi.updatejobtitle,t,function(e){"success"===e.code&&($("#backwpup-"+a+"-options").find(".backwpup-job-title").html(e.data.title),backwpupDisplaySettingsToast("success",e.message),closeSidebar())},"POST",function(e){backwpupDisplaySettingsToast("danger",e.responseJSON.message)})}),$("#bulk-actions-apply").on("click",function(){const e=$(this).data("action"),a=$backupsTable.find("input[type=checkbox]:checked").map(function(){return{dataset:$(this).data("delete")}}).get();requestWPApi(backwpupApi.backups_bulk_actions,{action:e,backups:a},function(e){loadBackupsListingAndPagination(getUrlParameter("page_num",1))},"POST"),$(".js-backwpup-select-all").prop("checked",!1)}),$("#bulk-actions-select").on("change",function(){const e=$(this).val();$("#bulk-actions-apply").data("action",e)}),$document.on("click","#save-excluded-tables",function(){const e=$(".js-backwpup-tables-list input[type='checkbox']"),a=$(this).closest("article"),t=[];e.each(function(){$(this).is(":checked")&&t.push($(this).val())});const n=a.find("input[type='hidden']"),o=[];n.each(function(){o.push({name:$(this).attr("name"),value:$(this).val()})}),t.forEach(function(e){o.push({name:"tabledb[]",value:e})});const s=$.param(o);requestWPApi(backwpupApi.save_excluded_tables,s,function(e){200===e.status&&($("#backwpup-onboarding-panes").length||backwpupDisplaySettingsToast("success",e.message),closeSidebar())},"POST")}),$(".js-backwpup-license_update").on("click",update_license),$document.on("click",".file-exclusions-submit",function(e){const a=$(this).closest("article").find("input"),t={};function n(e,a){e.endsWith("[]")?(t[e]||(t[e]=[]),a&&t[e].push(a)):t[e]=a}a.each(function(){$(this).is(":checkbox")?$(this).is(":checked")&&n($(this).attr("name"),$(this).val()):n($(this).attr("name"),$(this).val())}),$('[id^="sidebar-exclude-files-"]').each(function(){$(this).find("input").each(function(){$(this).is(":checkbox")?$(this).is(":checked")&&n($(this).attr("name"),$(this).val()):n($(this).attr("name"),$(this).val())})});const o=$.param(t);requestWPApi(backwpupApi.save_file_exclusions,o,function(e){200===e.status&&(closeSidebar(),$("#backwpup-onboarding-panes").length||backwpupDisplaySettingsToast("success",e.message))},"POST")}),$(document).on("start-backupjob",function(){enableBackupButton(!1),enableDeleteJob(!1)}),$(document).on("backup-complete",function(){enableBackupButton(!0),enableDeleteJob(!0),loadBackupsListingAndPagination(getUrlParameter("page_num",1))}),window.location.search.includes("backwpupfirstbackup")&&!isGenerateJsIncluded()){let e=$("#backwpup_first_backup_job_id").val();requestWPApi(backwpupApi.startbackup,{first_backup:1,job_id:e},function(e){200===e.status?setTimeout(function(){window.location.reload()},500):301===e.status&&(window.location=e.url)},"POST")}var buyProMenuItem=$('#toplevel_page_backwpup ul li a[href="admin.php?page=buypro"]');buyProMenuItem.length&&(buyProMenuItem.attr("href","https://backwpup.com/#buy"),buyProMenuItem.attr("target","_blank"),buyProMenuItem.css({color:"#3ac495","font-weight":"bold"}));var DocsMenuItem=$('#toplevel_page_backwpup ul li a[href="admin.php?page=docs"]');function runWhenJobFrequencySettingsLoaded(){const e=$(".js-backwpup-frequency-job");e.length&&showFrequencyJobFields(e.val())}DocsMenuItem.length&&(DocsMenuItem.attr("href","https://backwpup.com/docs/"),DocsMenuItem.attr("target","_blank")),$(".bwpup-ajax-close").click(function(e){e.preventDefault();let a=$(this),t=a.attr("href");if(!t)return;let n=a.data("bwpu-hide");$("#"+n).fadeTo("slow","0.2"),$.ajax({url:t,success:function(e){$("#"+n).hide()}})}),$(document).on("click","#bwp-settings-toast #dismiss-icon",function(){const e=$("#bwp-settings-toast").children();e.removeClass("opacity-100 translate-y-0").addClass("opacity-0 translate-y-2"),setTimeout(()=>{e.remove()},300)});const observer=new MutationObserver(function(e){e.forEach(function(e){e.addedNodes.forEach(function(e){($(e).is(".js-backwpup-frequency-job")||$(e).find(".js-backwpup-frequency-job").length)&&runWhenJobFrequencySettingsLoaded()})})});function showFrequencyJobFields(e){$([".js-backwpup-frequency-job-show-if-hourly",".js-backwpup-frequency-job-show-if-weekly",".js-backwpup-frequency-job-show-if-monthly",".js-backwpup-frequency-job-hide-if-hourly"].join(", ")).hide(),["daily","weekly","monthly"].includes(e)&&$(".js-backwpup-frequency-job-hide-if-hourly").show(),$(`.js-backwpup-frequency-job-show-if-${e}`).show()}observer.observe(document.body,{childList:!0,subtree:!0}),$document.on("change",".js-backwpup-frequency-job",function(){showFrequencyJobFields($(this).val())}),$document.on("click","#save-job-settings",function(){const e=$(this).closest("article"),a={frequency:e.find("select[name='frequency']").val(),start_time:e.find("input[name='start_time']").val(),hourly_start_time:e.find("select[name='hourly_start_time']").val(),day_of_week:e.find("select[name='day_of_week']").val(),day_of_month:e.find("select[name='day_of_month']").val(),job_id:e.find("input[name='job_id']").val()};requestWPApi(backwpupApi.save_job_settings,a,function(e){if(200===e.status){$(`#backwpup-${a.job_id}-options div span.label-scheduled`).html(e.next_backup);const t=$("#backwpup-onboarding-panes"),n=$("#sidebar-frequency").find("select[name='frequency']");t.length?(console.log("select[name='job_"+a.job_id+"_frequency']"),t.find("select[name='job_"+a.job_id+"_frequency']").val(n.val())):backwpupDisplaySettingsToast("success",e.message),closeSidebar()}},"POST")}),runWhenJobFrequencySettingsLoaded(),$document.on("click",".backwpup-start-backup-job",function(){startBackupProcess({job_id:$(this).data("job_id")}),closeModal()})}),function(e){var a=e.fn.hide;e.fn.hide=function(){return this.trigger("hide"),a.apply(this,arguments)}}(jQuery),document.addEventListener("DOMContentLoaded",function(){document.addEventListener("click",function(e){const a=document.querySelectorAll(".js-backwpup-unselect-storage"),t=e.target.closest(".js-backwpup-unselect-storage");if(a.length>1&&t){const e={job_id:t.dataset.jobId,name:t.dataset.storage},a=t.querySelector('input[type="checkbox"]'),n=a.checked;"function"==typeof requestWPApi&&requestWPApi(backwpupApi.storages,e,function(e){200===e.status&&(t.classList.toggle("js-backwpup-unselect-storage"),a.checked=!n)},"POST",function(e,a){console.log(e),console.log(a),alert(e.responseJSON.error)})}})});