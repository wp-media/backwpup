window.BWU=window.BWU||{},function(o,r,n,e){"use strict";var i={restoreSuccess:function(){return n("#restore_progress").text(e.successDatabaseRestored),this.closeSource(),this},restoreFailed:function(){return n("#restore_progress").text(e.failedRestore),this.closeSource(),this},onOpen:function(){return n("#start-restore").prop("disabled",!0),n("#restore_progress").text(e.restoringDatabase),this},closeSource:function(){return this.eventSource.close(),n("#start-restore").prop("disabled",!1),this},onDone:function(e){this.errors?this.restoreFailed():this.restoreSuccess(),r.isFunction(this.options.onSuccessCallback)&&this.options.onSuccessCallback.call(this,e)},onMessage:function(e){var t=JSON.parse(e.data);return"done"===t.state&&this.onDone(t),r.isFunction(this.options.onMessageCallback)&&this.options.onMessageCallback.call(this,t),this},onError:function(e){var t=(e=JSON.parse(e.data)).message,s=n("#restore_step");return this.eventSource.close(),e.state&&"error"===e.state&&(o.Functions.printMessageError(t,s),n("body").trigger(this.ACTION_DATABASE_RESTORE_ERROR,t),this.errors++),this},restore:function(){return"EventSource"in window?(this.eventSource=new EventSource(this.url+"?action=restore_db&context=event_source&controller=job&backwpup_action_nonce="+this.nonce),this.eventSource.onmessage=this.onMessage,this.eventSource.onopen=this.onOpen,this.eventSource.addEventListener("log",this.onError)):console.warn(e.noEventSourceInWindowObject),this},init:function(){return this},construct:function(e,t,s){return r.bindAll(this,"restoreSuccess","restoreFailed","onOpen","closeSource","onDone","onMessage","onError","restore","init"),this.eventSource=null,this.url=e,this.nonce=t,this.options={onMessageCallback:null,onSuccessCallback:null},r.extend(this.options,s),this}};o.Restore.FactoryDatabaseRestore=function(e,t,s){return Object.create(i,{ACTION_DATABASE_RESTORE_ERROR:o.Functions.makeConstant("backwpup.database_restore_error")}).construct(e,t,s)}}(window.BWU,window._,window.jQuery,window.backwpupRestoreLocalized);