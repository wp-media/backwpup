window.BWU=window.BWU||{},function(i,a,s,e){"use strict";if(!("EventSource"in window))return console.warn(e.noEventSourceInWindowObject);var c={onMessage:function(e){var t=JSON.parse(e.data);return t.state===i.States.DOWNLOADING&&(s("#onstep").text(t.filename),s("#progressstep").css({width:t.download_percent+"%"}).text(t.download_percent+"%")),t.state===i.States.DONE&&(this.eventSource.close(),s("body").trigger(this.ACTION_DOWNLOAD_SUCCESS,e)),this},onError:function(e){var t=JSON.parse(e.data),o=s("body"),n=this.ACTION_DOWNLOAD_ERROR;return this.eventSource.close(),t.message===i.States.NEED_DECRYPTION_KEY?n=this.ACTION_DOWNLOAD_REQUIRE_DECRYPTION:i.Functions.printMessageError(t.message,s("#restore_step")),o.trigger(n,e),this},download:function(){var e=void 0===this.remoteFilePath?"":this.remoteFilePath;return this.eventSource=new EventSource(this.url+"?action=download&context=event_source&controller=job&backwpup_action_nonce="+this.nonce+"&source_file_path="+e+"&service="+this.service+"&jobid="+this.jobId+"&local_file_path="+this.localFilePath),this.eventSource.onmessage=this.onMessage,this.eventSource.addEventListener("log",this.onError),this},construct:function(e,t,o,n,s,r){return a.bindAll(this,"onMessage","onError","download"),this.eventSource=null,this.url=e,this.nonce=t,this.remoteFilePath=o,this.service=n,this.jobId=s,this.localFilePath=r,this}};i.Restore.FactoryDownload=function(e,t,o,n,s,r){return Object.create(c,{ACTION_DOWNLOAD_SUCCESS:i.Functions.makeConstant("backwpup.download_success"),ACTION_DOWNLOAD_ERROR:i.Functions.makeConstant("backwpup.download_error"),ACTION_DOWNLOAD_REQUIRE_DECRYPTION:i.Functions.makeConstant("backwpup.download_require_decryption")}).construct(e,t,o,n,s,r)}}(window.BWU,window._,window.jQuery,window.backwpupRestoreLocalized);