window.BWU=window.BWU||{},window.BWU.Restore=window.BWU.Restore||{},function(o,n,r,e){"use strict";if("EventSource"in window){var i={onMessage:function(e){var t=JSON.parse(e.data);return t.fileName&&(r("#onstep").text(t.fileName),r("#progressstep").css({width:o.Restore.Functions.calculatePercentage(t.index,t.remains)+"%"}).text(o.Restore.Functions.calculatePercentage(t.index,t.remains)+"%")),o.States.DONE===t.state&&(this.eventSource.close(),r("body").trigger(this.ACTION_DECOMPRESS_SUCCESS,e)),this},onError:function(e,t,s){var n=JSON.parse(e.data);return this.eventSource.close(),n.message!==o.States.NEED_DECRYPTION_KEY&&o.Functions.printMessageError(n.message,r("#restore_step")),r("body").trigger(this.ACTION_DECOMPRESS_FAILED,e,s),this},decompress:function(){return this.eventSource=new EventSource(this.url+"?action=decompress_upload&context=event_source&controller=job&backwpup_action_nonce="+this.nonce+"&file_path="+this.filePath),this.eventSource.onmessage=this.onMessage,this.eventSource.addEventListener("log",this.onError),r("#upload_progress").text(e.extractingArchive),r("#progressstep").css({width:"0%"}).text("0%"),this},construct:function(e,t,s){return n.bindAll(this,"onMessage","onError","decompress"),this.eventSource=null,this.url=e,this.nonce=t,this.filePath=n.isEmpty(s)?"":s,this}};o.Restore.FactoryDecompress=function(e,t,s){return Object.create(i,{ACTION_DECOMPRESS_SUCCESS:o.Functions.makeConstant("backwpup.decompress_success"),ACTION_DECOMPRESS_FAILED:o.Functions.makeConstant("backwpup.decompress_failed")}).construct(e,t,s)}}else console.warn(e.noEventSourceInWindowObject)}(window.BWU,window._,window.jQuery,window.backwpupRestoreLocalized);